extends layout-admin

block content
  #cover-spin
  .main-panel
    .container
      .panel-header.bg-primary-gradient
        div(style="padding:5px 20px 0px 20px;")
          .d-flex.align-items-left.align-items-md-center.flex-column.flex-md-row
            div
              h2.text-white.pb-2.fw-bold Add Lead
              h5.text-white.op-7.mb-2 Welcome to Admin Panel
            .ml-md-auto.py-2.py-md-0
              if h.checkPermission(session.user, permissionCacheData, "LeadListing") || checkSuperAdmin
                a.btn.btn-white.btn-border.btn-round.mr-2(href='javascript:void(0);' onclick="chooseExistingLead();") Add Sibling
                a.btn.btn-white.btn-border.btn-round.mr-2(href='/admin/lead/all') All Lead
              a.btn.btn-white.btn-border.btn-round.mr-2(href='/admin/dashboard') Dashboard
      .page-inner
        .row
          form#add_lead.col-md-12(action="/admin/lead/add", method="POST")
            if type == "super_admin"
              .card
                .card-header
                  .card-title Center
                .card-body
                  .row
                    .col-md-6.col-lg-12
                      .form-group
                        label(for='school_id') Select Center
                        span.required-label *
                        select#school.form-control(name='school_id', required='')
                          option(value='') Select School
                          each center in centers
                            option(value=center._id) #{center.school_display_name}
            else
              .card
                .card-header
                  .card-title Center
                .card-body
                  .row
                    .col-md-6.col-lg-12
                      .form-group
                        label(for='school_id') Select Center
                        span.required-label *
                        select#school.form-control(name='school_id', required='')
                          option(value='') Select School
                          //- each center in centers
                          //- option(value=centers._id selected)  #{centers.school_display_name}
                          //- input#school_input.form-control(type='text' name='school_id' value=centers._id)
                          if centers.length == 1
                            each center in centers
                              option(value=center._id selected) #{center.school_display_name}
                          else
                            each center in centers
                              option(value=center._id) #{center.school_display_name}
            .card
              .card-header
                .card-title Child Information
              .card-body
                .row
                  .col-md-6.col-lg-4
                    .form-group
                      label(for='child_first_name') First Name
                      span.enquiry-mark.required-label *
                      input#child_first_name.form-control(type='text' name='child_first_name' placeholder='Enter First Name')

                  .col-md-6.col-lg-4
                    .form-group
                      label(for='child_last_name') Last Name
                      span.enquiry-mark.required-label *
                      input#child_last_name.form-control(type='text' name='child_last_name' placeholder='Enter Last Name')

                  .col-md-6.col-lg-4
                    .form-group
                      label(for='exampleFormControlSelect1') Select Gender
                      span.enquiry-mark.required-label *
                      select#gender.form-control(name='child_gender')
                        option(value='') Select Gender
                        option(value="Male") Male
                        option(value="Female") Female
                  .col-md-6.col-lg-4
                    .form-group
                      label(for='dob') Date of birth
                      span.enquiry-mark.required-label *
                      //- .input-group
                        //- input#dob.form-control(type='text' name='child_dob' required='')
                      input#dob.form-control.custom-input.date(type='text' name='child_dob' autocomplete="off" value="" onkeydown="return false;")
                  .col-md-6.col-lg-4
                    .form-group
                      label(for='programcategory_id') Select Program Category
                      span.required-label *
                      select#programcategory.form-control(name='programcategory_id', required='')
                        option(value='') Select ProgramCategory
                        //- each programcategory in programcategorys
                        //-   option(value=programcategory._id) #{programcategory.title}
                  .col-md-6.col-lg-4
                    .form-group
                      label(for='program_id') Select Program
                      span.enquiry-mark.required-label *
                      select#program.form-control(name='program_id')
                        //- option(value='') Select Program
                        //- each program in programs
                        //-   option(value=program._id) #{program.program_name}
                  #child_attended.col-md-6.col-lg-12
                    .form-group
                      label.form-label(for='child_pre_school') Has Child attended preschool before?
                      span.enquiry-mark.required-label *
                      br
                      .selectgroup.w-25
                        label.selectgroup-item
                          input#yes.selectgroup-input(type='radio' name='child_pre_school' value='yes')
                          span.selectgroup-button Yes
                        label.selectgroup-item
                          input#no.selectgroup-input(type='radio' name='child_pre_school' value='no' checked='')
                          span.selectgroup-button No
                  //- .col-md-6.col-lg-4
                  //-   .form-group
                  //-      label(for='child_pre_school') Has Child attended preschool before?
                  //-     input#child_pre_school.form-control(type='text' name='child_pre_school' placeholder='Enter Child pre school')
            //- .card
            //-   .card-header
            //-     .card-title School Title
            //-   .card-body
            //-     .row
            //-       .col-md-6.col-lg-12
            //-         .form-group
            //-           label(for='school_id') Select School
            //-           select#school.form-control(name='school_id', required='')
            //-             option(value='') Select School
            //-             each center in centers
            //-               option(value=center._id) #{center.school_name}
            .card
              .card-header
                .card-title Primary Parent Detail
              .card-body
                .row
                  .col-md-6.col-lg-6
                    .form-group
                      label(for='exampleFormControlSelect1') Select Parent
                      span.required-label *
                      select#parent.form-control.select2(name='primary_parent', required='')
                        option(value='') Select Parent
                        option(value="Mother") Mother
                        option(value="Father") Father
                        option(value="Guardian") Guardian
                  .col-md-6.col-lg-6
                    .form-group
                      label(for='parent_name') Name
                      span.required-label *
                      input#parent_name.form-control(type='text' name='parent_name' required='' placeholder='Enter Parent Name')
                  .col-md-6.col-lg-4
                    .form-group
                      label(for='parent_first_contact') Contact 1
                      span.required-label *
                      input#parent_first_contact.form-control(type='text' required='' name='parent_first_contact' placeholder='Enter Contact 1')
                      .form-check
                        label.form-check-label
                          input.form-check-input(type='checkbox' name='whatsapp_first' id="checkItem1" checked tabindex="-1")
                          span.form-check-sign Whatsapp
                  .col-md-6.col-lg-4
                    .form-group
                      label(for='parent_second_contact') Contact 2
                      input#parent_second_contact.form-control(type='text' name='parent_second_contact' placeholder='Enter Contact 2')
                      .form-check
                        label.form-check-label
                          input.form-check-input(type='checkbox' name='whatsapp_second'  id="checkItem2" tabindex="-1")
                          span.form-check-sign Whatsapp

                  .col-md-6.col-lg-4
                    .form-group
                      label(for='parent_email') Email Id
                      span.required-label *
                      input#parent_email.form-control(type='text' required='' name='parent_email' placeholder='Enter Email')
                      p#primary_err(style="display:none;font-size: 13px;color: red;") This email with LD004839 already exist. Use different email address.
                  .col-md-6.col-lg-6
                    .form-group
                      label(for='parent_education') Education
                      span.enquiry-mark.required-label *
                      input#parent_education.form-control(type='text' name='parent_education'  placeholder='Enter Parent education')
                  .col-md-6.col-lg-6
                    .form-group
                      label(for='parent_profession') Profession
                      span.enquiry-mark.required-label *
                      input#parent_profession.form-control(type='text' name='parent_profession' placeholder='Enter Parent Profession')
                  #cor_parent.col-md-3.col-lg-3
                    .form-group
                      label.form-label(for='lead_type') Lead type:
                      br
                      .selectgroup.w-25
                        label.selectgroup-item
                          input#partner_corporate.selectgroup-input(type='radio' name='cor_parent' value='partner_corporate')
                          span.selectgroup-button Partner Corporate
                        label.selectgroup-item
                          input#others.selectgroup-input(type='radio' name='cor_parent' value='others' checked='')
                          span.selectgroup-button Others
                  #comp_name_div.col-md-9.col-lg-9
                    .form-group
                      label(for='company_name_parent') Company Name
                      span.enquiry-mark.required-label *
                      input#company_name_parent.form-control(type='text' name='company_name_parent' placeholder='Enter Parent Company Name')
            //- .card
            //-   .card-header
            //-     .card-title Secondary Parent Detail
            //-   .card-body
            //-     .row
            //-       .col-md-6.col-lg-6
            //-         .form-group
            //-           label(for='exampleFormControlSelect1') Select Parent
            //-           select#exampleFormControlSelect1.form-control(name='secondary_parent_type', required='')
            //-             option(value="Mother ") Mother
            //-             option(value="Father") Father
            //-             option(value="Guradian") Guradian
            //-       .col-md-6.col-lg-6
            //-         .form-group
            //-           label(for='secondary_parent_name') Name
            //-           input#secondary_parent_name.form-control(type='text' name='secondary_parent_name' placeholder='Enter Parent Name')
            //-       col-md-6.col-lg-3
            //-         .form-group
            //-           label(for='secondary_first_contact') Contact 1
            //-           input#secondary_first_contact.form-control(type='text' name='secondary_first_contact' placeholder='Enter Contact 1')
            //-       col-md-6.col-lg-1
            //-         .form-group
            //-           label(for='secondary_whatsapp') whatsapp
            //-           input(type="checkbox" name='secondary_whatsapp')
            //-       col-md-6.col-lg-3
            //-         .form-group
            //-           label(for='secondary_Second_contact') Contact 2
            //-           input#secondary_Second_contact.form-control(type='text' name='secondary_Second_contact' placeholder='Enter contact 2')
            //-       col-md-6.col-lg-1
            //-         .form-group
            //-           label(for='secondary_whatsapp') whatsapp
            //-           input(type="checkbox" name='secondary_whatsapp')
            //-       col-md-6.col-lg-4
            //-         .form-group
            //-           label(for='secondary_email') Email Id
            //-           input#secondary_email.form-control(type='text' name='secondary_email' placeholder='Enter Email')
            //-       //- .col-md-6.col-lg-6
            //-       //-   .form-group
            //-       //-     label(for='secondary_education') Education
            //-       //-     input#secondary_education.form-control(type='text' name='secondary_education' placeholder='Enter Parent education')
            //-       //- .col-md-6.col-lg-6
            //-       //-   .form-group
            //-       //-     label(for='secondary_profession') Profession
            //-       //-     input#secondary_profession.form-control(type='text' name='secondary_profession' placeholder='Enter Parent Profession')

            .card
              .card-header
                .card-title Primary Parent Address
              .card-body
                .row
                  .col-md-6.col-lg-4
                    .form-group
                      label(for='school_id') Select Country
                      span.enquiry-mark.required-label *
                      select#country.form-control(name='parent_country' )
                        option(value='') Select Country
                        each employee in employees
                          option(value=`${employee.country_id}|${employee._id}`) #{employee.country_name}
                      //- label(for='parent_country') Country
                      //- input#parent_country.form-control(type='text' name='parent_country' placeholder='Enter Parent Country')
                  .col-md-6.col-lg-4
                    .form-group
                      label(for='parent_state') State
                      span.enquiry-mark.required-label *
                      select#state.form-control(name='parent_state')
                        option(value='') Select State
                  .col-md-6.col-lg-4
                    .form-group
                      label(for='parent_city') City
                      span.enquiry-mark.required-label *
                      select#city.form-control(name='parent_city')
                        option(value='') Select city
                    //- .form-group
                    //-   label(for='parent_pincode') Pincode
                    //-   input#parent_pincode.form-control(type='text' name='parent_pincode' placeholder='Enter Parent Pincode')
                  .col-md-6.col-lg-4
                    .form-group
                      label(for='parent_area') Area
                      span.enquiry-mark.required-label *
                      input#parent_area.form-control(type='text' name='parent_area' placeholder='Enter Parent Area')
                  .col-md-6.col-lg-4
                    .form-group
                      label(for='parent_pincode') Pincode
                      span.enquiry-mark.required-label *
                      input#parent_pincode.form-control(type='text' name='parent_pincode' placeholder='Enter Parent Pincode')
                  .col-md-6.col-lg-4
                    .form-group
                      //- .form-check
                        label.form-check-label
                          input.form-check-input(type='checkbox' name='sel_know_check' id="sel_know_check")
                          span.form-check-sign Select All
                      label(for='exampleFormControlSelect1') How did you come to Know about us
                      span.required-label *
                      select#know_us.form-control(name='parent_know_aboutus' , multiple='multiple')
                        option(value='') How did you come to Know about us*
                        each knowus in knowuss
                          option(value=knowus.name) #{knowus.name}
                  #landmark.col-md-6.col-lg-3
                    .form-group
                      label(for='parent_landmark') Landmark
                      span.enquiry-mark.required-label *
                      input#parent_landmark.form-control(type='text' name='parent_landmark' placeholder='Enter Parent Landmark')
                  #house.col-md-6.col-lg-3
                    .form-group
                      label(for='parent_house') House
                      span.enquiry-mark.required-label *
                      input#parent_house.form-control(type='text' name='parent_house' placeholder='Enter Parent House')
                  #street.col-md-6.col-lg-3
                    .form-group
                      label(for='parent_street') Street
                      span.enquiry-mark.required-label *
                      input#parent_street.form-control(type='text' name='parent_street' placeholder='Enter Parent Street')
                  #address_s.col-md-6.col-lg-3
                    .form-group
                      label(for='parent_address') Address
                      span.enquiry-mark.required-label *
                      input#parent_address.form-control(type='text' name='parent_address' placeholder='Enter Parent Address')
                  //- .col-md-6.col-lg-3
                  //-   .form-group
                  //-     label(for='parent_landmark') Landmark
                  //-     input#parent_landmark.form-control(type='text' name='parent_landmark' placeholder='Enter Parent Landmark')
                  //- .col-md-6.col-lg-3
                  //-   .form-group
                  //-     label(for='parent_house') House
                  //-     input#parent_house.form-control(type='text' name='parent_house' placeholder='Enter Parent House')
                  //- .col-md-6.col-lg-3
                  //-   .form-group
                  //-     label(for='parent_street') Street
                  //-     input#parent_street.form-control(type='text' name='parent_street' placeholder='Enter Parent Street')
                  //- .col-md-6.col-lg-3
                  //-   .form-group
                  //-     label(for='parent_address') Address
                  //-     input#parent_address.form-control(type='text' name='parent_address' placeholder='Enter Parent Address')
            #secondary_detail.card
              .card-header
                .card-title Secondary Parent Detail
              .card-body
                .row
                  .col-md-6.col-lg-6
                    .form-group
                      label(for='exampleFormControlSelect2') Select Parent
                      span.required-label *
                      select#secondary_parent.form-control(name='secondary_parent_type', required='')
                        option(value='') Select Parent
                        option(value="Mother ") Mother
                        option(value="Father") Father
                        option(value="Guardian") Guardian
                  .col-md-6.col-lg-6
                    .form-group
                      label(for='secondary_parent_name') Name
                      span.required-label *
                      input#secondary_parent_name.form-control(type='text' name='secondary_parent_name' placeholder='Enter Parent Name' required="")
                  .col-md-6.col-lg-4
                    .form-group
                      label(for='secondary_first_contact') Contact 1
                      span.enquiry-mark.required-label *
                      input#secondary_first_contact.form-control(type='text' name='secondary_first_contact' placeholder='Enter Contact 1')
                      .form-check
                        label.form-check-label
                          input.form-check-input(type='checkbox' name='secondary_first_whatsapp'  id="checkItemSec1")
                          span.form-check-sign Whatsapp
                  .col-md-6.col-lg-4
                    .form-group
                      label(for='secondary_Second_contact') Contact 2
                      input#secondary_Second_contact.form-control(type='text' name='secondary_Second_contact' placeholder='Enter Contact 2')
                      .form-check
                        label.form-check-label
                          input.form-check-input(type='checkbox' name='secondary_second_whatsapp' id="checkItemSec2")
                          span.form-check-sign Whatsapp
                  .col-md-6.col-lg-4
                    .form-group
                      label(for='secondary_email') Email Id
                      span.enquiry-mark.required-label *
                      input#secondary_email.form-control(type='text' required="" name='secondary_email' placeholder='Enter Email')
                      p#secondary_err(style="display:none;font-size: 13px;color: red;") This email with LD004839 already exist. Use different email address.
                  .col-md-6.col-lg-6
                    .form-group
                      label(for='secondary_education') Education
                      span.enquiry-mark.required-label *
                      input#secondary_education.form-control(type='text' name='secondary_education' placeholder='Enter Parent education')
                  .col-md-6.col-lg-6
                    .form-group
                      label(for='secondary_profession') Profession
                      span.enquiry-mark.required-label *
                      input#secondary_profession.form-control(type='text' name='secondary_profession' placeholder='Enter Parent Profession')
            .card
              .card-header
                .card-title Source Category
              .card-body
                .row
                  .col-md-6.col-lg-4
                    .form-group
                      label(for='source_category') Source Category
                      span.enquiry-mark.required-label *
                      select#source.form-control(name='source_category')
                        option(value='') Select Source Category
                        option(value="direct-walk-in") Direct Walk in
                        option(value="digital-lead") Digital Lead
                        option(value="database/events") Database/Events
                  .col-md-6.col-lg-4
                    .form-group
                      label(for='status_id') Select Status
                      span.required-label *
                      select#status.form-control(name='status_id', required='')
                        option(value='') Select Status
                        each statuse in statuses
                          if statuse.name !== "Booked a tour"
                            option(value=statuse._id data-type=statuse.type data-stage=statuse.stage) #{statuse.name}
                  .col-md-6.col-lg-4
                    .form-group
                      label(for='substatus_id') Select Sub Status
                      span.required-label *
                      select#substatus.form-control(name='substatus_id', required='')
                        //- option(value='') Select Sub Status
                        //- each statuse in statuses
                        //-   option(value=statuse._id) #{statuse.name}
                  .col-md-6.col-lg-12
                    .form-group
                      //- label(for='stage') Stage
                      input#stage.form-control(type='hidden' name='stage' placeholder='Enter stage')
                      input#lead_type.form-control(type='hidden' name='lead_type' placeholder='Enter stage')
                  .col-md-6.col-lg-12
                    .form-group
                      //- .form-check
                        label.form-check-label
                          input.form-check-input(type='checkbox' name='sel_action_check' id="sel_action_check")
                          span.form-check-sign Select All
                      label(for='action_taken') Action Planned / Taken
                      span.enquiry-mark.required-label *
                      select#action_planned.form-control(name='action_taken[]',multiple='multiple' )
                        each action in actions
                          option(value=action.name) #{action.name}
                  .col-md-6.col-lg-12
                    .form-group
                      label(for='remark') Remark
                      //- input#remark.form-control(type='text' name='remark' placeholder='Enter Remark')
                      textarea.form-control(rows='5', cols='5', id="msg_desc", name="remark")
                  //- .col-md-6.col-lg-12
                  //-   .form-group
                  //-     label(for='action_taken') Select Action Planned
                  //-     span.required-label *
                  //-     select#action_planned.form-control(name='action_taken', required='',multiple='multiple' )
                  //-       each action in actions
                  //-         option(value=action.name) #{action.name}

            .card
              .row
                col-md-6.col-lg-4
                  .form-check
                    label.form-check-label
                      input.form-check-input(type='checkbox' name='sibling'  id="checkItem")
                      span.form-check-sign Add Sibling Detail

            .card-action
              .row
                .col-md-12
                  button.btn.btn-color.sub_form(type="submit") Add Lead

  block script
    script(type='text/javascript' src='https://cdn.jsdelivr.net/momentjs/latest/moment.min.js')
    script(type='text/javascript' src='https://cdn.jsdelivr.net/npm/daterangepicker/daterangepicker.min.js')

  script.
    var centers = !{JSON.stringify(centers)}
    var type = !{JSON.stringify(type)}
    var checkInq;
    $("#school_input").hide();
    $(document).ready(function () {
      $("#parent_email").keyup(function () {
        $.ajax({
          method: 'POST',
          url: `/admin/lead/check/email/validation`,
          data: {
            emailId: $('#parent_email').val(),
            type: "primary"
          },
          dataType: 'json',
          success: function (response) {
            //- swal.close();
            console.log(response,"response");
            if (response && response.data) {
              $("#primary_err").css("display", "block");
              $("#primary_err").text(`This email with ${response.data.lead_no} already exist. Use different email address.`);
              $(".sub_form").prop("disabled", true);
              sall(`This email with ${response.data.lead_no} already exist. Use different email address.`, 2500)
            } else {
              $("#primary_err").css("display", "none");
              $(".sub_form").prop("disabled", false);
            }
          }
        });
      })

      $("#secondary_email").keyup(function () {
        $.ajax({
          method: 'POST',
          url: `/admin/lead/check/email/validation`,
          data: {
            secondary_email: $('#secondary_email').val(),
            type: "secondary"
          },
          dataType: 'json',
          success: function (response) {
            //- swal.close();
            //- console.log(response,"response");
            if (response && response.data) {
              $("#secondary_err").css("display", "block");
              $("#secondary_err").text(`This email with ${response.data.lead_no} already exist. Use different email address.`);
              sall(`This email with ${response.data.lead_no} already exist. Use different email address.`, 2500)
              $(".sub_form").prop("disabled", true);
            } else {
              $("#secondary_err").css("display", "none");
              $(".sub_form").prop("disabled", false);
            }
          }
        });
      })

      $("#comp_name_div").hide();
      let checkbox = document.getElementById("partner_corporate");
      let checkbox1 = document.getElementById("others");
      checkbox.addEventListener("change", () => {
         if (checkbox.checked) {
          $("#comp_name_div").show();
          $("#company_name_parent").prop("required", true);
         } else {
          $("#comp_name_div").hide();
          $("#company_name_parent").prop("required", false);
         }
      });
      checkbox1.addEventListener("change", () => {
         if (checkbox1.checked) {
          $("#comp_name_div").hide();
          $("#company_name_parent").prop("required", false);
         } else {
          $("#comp_name_div").show();
          $("#company_name_parent").prop("required", true);
         }
      });

      $(document).on("change", "#school", function() {
        window.onbeforeunload = function() {
          return '';
        };
      })
      document.querySelector('#child_first_name').onclick = function() {
        window.onbeforeunload = function() {
          return '';
        };
      }
      document.querySelector('#child_last_name').onclick = function() {
        window.onbeforeunload = function() {
          return '';
        };
      }
      document.querySelector('#programcategory').onclick = function() {
        window.onbeforeunload = function() {
          return '';
        };
      }
      document.querySelector('#program').onclick = function() {
        window.onbeforeunload = function() {
          return '';
        };
      }

      $("#child_attended").hide();
      $("#landmark").hide();
      $("#secondary_detail").hide();
      $("#house").hide();
      $("#street").hide();
      $("#address_s").hide();
      $("#add_lead").submit(function () {
        window.onbeforeunload = null;
        $(".sub_form").attr("disabled", true);
        $('#cover-spin').show(0);
        return true;
      });
    });

    $(document).ready(function () {
      let checkbox = document.getElementById("checkItem1");
      checkbox.addEventListener("change", () => {
         if (checkbox.checked) {
          $("#parent_first_contact").prop("required", true);
          $("#parent_second_contact").prop("required", false);
          $("#checkItem2").prop('checked', false);
         } else {
          alert('parent_first_contact-false');
          $("#checkItem2").prop('checked', true);
          $("#parent_first_contact").prop("required", false);
         }
      });

      let checkbox2 = document.getElementById("checkItem2");
      checkbox2.addEventListener( "change", () => {
         if (checkbox2.checked) {
          $("#parent_second_contact").prop("required", true);
          $("#parent_first_contact").prop("required", false);
          $("#checkItem1").prop('checked', false);
         } else {
          alert('parent_second_contact-false');
          $("#checkItem2").prop('checked', true);
          $("#parent_second_contact").prop("required", false);
         }
      });
      var startdate = new Date();
      startdate.setFullYear(startdate.getFullYear() - 10);
      $(`#dob`).daterangepicker({
        autoUpdateInput: false,
        singleDatePicker: true,
        maxDate: new Date(),
        minDate:startdate,
        showDropdowns: true,
        autoApply: true
      }, function (start, end, label) {
        $("#dob").val(start.format('YYYY/MM/DD'))
      });
      $('#dob').on('apply.daterangepicker', function(ev, picker) {
        $(this).val(picker.startDate.format('MM/DD/YYYY'));
      });
      $('#secondary_parent').select2({
        placeholder: "Select Parent",
        theme: "bootstrap"
      });
      $('#know_us').select2({
        placeholder: "Select Known Us",
        theme: "bootstrap",
        closeOnSelect: false
      });
      $("#sel_know_check").click(function(){
        if($("#sel_know_check").is(':checked') ){
          $("#know_us > option").prop("selected","selected");
          $("#know_us").trigger("change");
        }else{
          $("#know_us > option").removeAttr("selected");
          $("#know_us").trigger("change");
        }
      });
      $('#programcategory').select2({
        placeholder: "Select Program Category",
        theme: "bootstrap"
      });
      $('#source').select2({
        placeholder: "Select Source",
        theme: "bootstrap"
      });
      $('#parent').select2({
        placeholder: "Select Parent",
        theme: "bootstrap"
      });
      $('#country').select2({
        placeholder: "Select Country",
        theme: "bootstrap"
      });
      $('#state').select2({
        placeholder: "Select State",
        theme: "bootstrap"
      });
      $('#gender').select2({
        placeholder: "Select Gender",
        theme: "bootstrap"
      });
      //- console.log(type,"user")
      if(type == "super_admin"){
        $('#school').select2({
          placeholder: "Select Center",
          theme: "bootstrap"
        });
      }else{
        $('#school').select2({
        placeholder: "Select Center",
        theme: "bootstrap",
        //- disabled: true
      });
      }
      $('#city').select2({
        placeholder: "Select City",
        theme: "bootstrap"
      });
      $('#action_planned').select2({
        placeholder: "Select Action Planned",
        theme: "bootstrap",
        closeOnSelect: false
      });
      $("#sel_action_check").click(function(){
        if($("#sel_action_check").is(':checked') ){
          $("#action_planned > option").prop("selected","selected");
          $("#action_planned").trigger("change");
        }else{
          $("#action_planned > option").removeAttr("selected");
          $("#action_planned").trigger("change");
        }
      });
      $('#program').select2({
        placeholder: "Select Program",
        theme: "bootstrap"
      });
      $('#status').select2({
        placeholder: "Select Status",
        theme: "bootstrap"
      });
      $('#substatus').select2({
        placeholder: "Select Substatus",
        theme: "bootstrap"
      });
      $(document).on('change', '#action_planned', function () {
        let actionsList = $("#action_planned option").length;
        var valueLength = $(this).val() ? $(this).val().length : 0;
          if (actionsList == valueLength) {
            $('#sel_action_check').prop('checked',true);
          } else {
            $('#sel_action_check').prop('checked',false);
          }
      })
      $(document).on('change', '#know_us', function () {
        let knowusList = $("#know_us option").length;
        var valueLength = $(this).val() ? $(this).val().length : 0;
          if (knowusList == valueLength) {
            $('#sel_know_check').prop('checked',true);
          } else {
            $('#sel_know_check').prop('checked',false);
          }
      })
      $(document).on('change', '#programcategory', function () {
      var id = $(this).val();
      //- console.log(id)

      $.ajax({
        method: 'POST',
        url: `/admin/lead/dropdown`,
        data: {
          type: id
        },
        dataType: 'json',
        success: function (response) {
          //- console.log(response,"response")

          $("#program").empty();
          $("#program").append(`<option value=''>Select Program</option>`);

          var len = response.data.length;
          for (var i = 0; i < len; i++) {
            var id = response.data[i]['_id'];
            var program_name = response.data[i]['program_name'];

            //- console.log(response,"responssse")
            //- console.log(id,"id")



          //-   // $(".testi_class").append("<option value='" + id + "'>" + name + "</option>");

            $("#program").append(`<option value='${id}'>${program_name}</option>`);

          }
          // $(".testi_class").select2("refresh");
        }
      });
    });
    $(".enquiry-mark").hide();
    $(document).on('change', '#status', function () {
      var id = $(this).val();
      var type = $(this).find(':selected').attr('data-type');
      var stage = $(this).find(':selected').attr('data-stage');

      $("#lead_type").val(type);
      $("#stage").val(stage);

      if (stage == "Post Tour" || stage == "Closed-Enquiry Lost" || stage == "Closed - Won") {
        //- console.log('show popup');
        $(".enquiry-mark").show();
        $("#child_attended").show();
        $("#landmark").show();
        $("#secondary_detail").show();
        $("#house").show();
        $("#street").show();
        $("#address_s").show();

        $("#parent_landmark").prop("required", true);
        $("#parent_house").prop("required", true);
        $("#parent_street").prop("required", true);
        $("#parent_address").prop("required", true);
        $("#secondary_parent").prop("required", true);
        $("#secondary_parent_name").prop("required", true);
        $("#secondary_email").prop("required", true);


        $("#child_first_name").prop("required", true);
        $("#gender").prop("required", true);
        $("#program").prop("required", true);

        $("#secondary_first_contact").prop("required", true);
        $("#checkItemSec1").prop("checked", true);
        checkInq = 1;

      } else {

        //- console.log('hide popup');
        $(".enquiry-mark").hide();
        $("#child_attended").hide();
        $("#landmark").hide();
        $("#secondary_detail").hide();
        $("#house").hide();
        $("#street").hide();
        $("#address_s").hide();

        $("#parent_landmark").prop("required", false);
        $("#parent_house").prop("required", false);
        $("#parent_street").prop("required", false);
        $("#parent_address").prop("required", false);
        $("#secondary_parent").prop("required", false);
        $("#secondary_parent_name").prop("required", false);
        $("#secondary_email").prop("required", false);

        $("#child_first_name").prop("required", false);
        $("#gender").prop("required", false);
        $("#program").prop("required", false);

        $("#secondary_first_contact").prop("required", false);
        $("#secondary_Second_contact").prop("required", false);
        $("#checkItemSec1").prop("checked", false);
        $("#checkItemSec2").prop("checked", false);

        checkInq = 0;
      }

      if (checkInq) {
        let checkbox = document.getElementById("checkItemSec1");
        checkbox.addEventListener( "change", () => {
          if (checkbox.checked) {
            $("#secondary_first_contact").prop("required", true);
            $("#secondary_Second_contact").prop("required", false);
            $("#checkItemSec2").prop('checked', false);
          } else {
            $("#checkItemSec2").prop('checked', true);
            $("#secondary_first_contact").prop("required", false);
          }
        });

        let checkbox2 = document.getElementById("checkItemSec2");
        checkbox2.addEventListener( "change", () => {
          if (checkbox2.checked) {
            $("#secondary_Second_contact").prop("required", true);
            $("#secondary_first_contact").prop("required", false);
            $("#checkItemSec1").prop('checked', false);
          } else {
            alert('parent_second_contact-false');
            $("#checkItemSec2").prop('checked', true);
            $("#secondary_Second_contact").prop("required", false);
          }
        });
      }

      //- console.log(id,"id")

      $.ajax({
        method: 'POST',
        url: `/admin/lead/status`,
        data: {
          type: id
        },
        dataType: 'json',
        success: function (response) {

          $("#substatus").empty();
          $("#substatus").append(`<option value=''>Select Substatus</option>`);

          var len = response.data.length;
          if(len == 1){
            for (var i = 0; i < len; i++) {
            //- console.log(response.data[i]);
            var id = response.data[i]['_id'];
            var program_name = response.data[i]['name'];
            var stage = response.data[i]['stage']

              $("#substatus").append(`<option value='${id}' selected>${program_name}</option>`);
            }
          }else{

            for (var i = 0; i < len; i++) {
              //- console.log(response.data[i]);
              var id = response.data[i]['_id'];
              var program_name = response.data[i]['name'];
              var stage = response.data[i]['stage']


              $("#substatus").append(`<option value='${id}'>${program_name}</option>`);
            }
          }
        }
      });
    });

    $(document).on('change', '#country', function () {
      var countryId = $(this).val();
      var id = countryId.split("|")[0];

      $.ajax({
        method: 'POST',
        url: `/admin/lead/state`,
        data: {
          type: id
        },
        dataType: 'json',
        success: function (response) {

          $("#state").empty();
          $("#state").append(`<option value=''>Select state</option>`);

          var len = response.data.length;
          for (var i = 0; i < len; i++) {
            var id = response.data[i]['_id'];
            var state_name = response.data[i]['state_name'];
            var state_id = response.data[i]['id']

            $("#state").append(`<option value='${state_id}|${id}'>${state_name}</option>`);

          }
        }
      });
    });
    $(document).on('change', '#state', function () {
      var stateId = $(this).val();
      var id = stateId.split("|")[0];
      //- console.log(id,"city")

      $.ajax({
        method: 'POST',
        url: `/admin/lead/city`,
        data: {
          type: id
        },
        dataType: 'json',
        success: function (response) {

          $("#city").empty();
          $("#city").append(`<option value=''>Select city</option>`);

          var len = response.data.length;
          for (var i = 0; i < len; i++) {
            var id = response.data[i]['_id'];
            var city_name = response.data[i]['city_name'];
            var city_id = response.data[i]['id']

            $("#city").append(`<option value='${city_id}|${id}'>${city_name}</option>`);

          }
        }
      });
    });
    if(type == "super_admin"){

      $(document).on('change', '#school', function () {
        var id = $(this).val();
        //- console.log(id,"school")


        $.ajax({
          method: 'POST',
          url: `/admin/lead/center`,
          data: {
            type: id
          },
          dataType: 'json',
          success: function (response) {

            $("#programcategory").empty();
            $("#programcategory").append(`<option value=''>Select programcategory</option>`);

            var len = response.data.length;
            for (var i = 0; i < len; i++) {
              var id = response.data[i]['_id'];
              var title = response.data[i]['title'];

              $("#programcategory").append(`<option value='${id}'>${title}</option>`);

            }
          }
        });
      });
    }else{
      //- $.ajax({
      //-     method: 'POST',
      //-     url: `/admin/lead/center`,
      //-     data: {
      //-       type: centers._id
      //-     },
      //-     dataType: 'json',
      //-     success: function (response) {
      //-       //- console.log(response,"response")

      //-       $("#programcategory").empty();
      //-       $("#programcategory").append(`<option value=''>Select programcategory</option>`);

      //-       var len = response.data.length;
      //-       for (var i = 0; i < len; i++) {
      //-         var id = response.data[i]['_id'];
      //-         var title = response.data[i]['title'];


      //-         //- console.log(response,"responssse")
      //-         //- console.log(id,"id")
      //-         //- console.log(title,"title")




      //-       //-   // $(".testi_class").append("<option value='" + id + "'>" + name + "</option>");

      //-         $("#programcategory").append(`<option value='${id}'>${title}</option>`);

      //-       }
      //-       // $(".testi_class").select2("refresh");
      //-     }
      //-   });
      if(centers.length == 1){
        for(let i=0; i<centers.length; i++){
          console.log(centers[i]["_id"],"idd")
          let id = centers[i]["_id"]
          $.ajax({
          method: 'POST',
          url: `/admin/lead/center`,
          data: {
            type: id
          },
          dataType: 'json',
          success: function (response) {

            $("#programcategory").empty();
            $("#programcategory").append(`<option value=''>Select programcategory</option>`);

            var len = response.data.length;
            for (var i = 0; i < len; i++) {
              var id = response.data[i]['_id'];
              var title = response.data[i]['title'];

              $("#programcategory").append(`<option value='${id}'>${title}</option>`);
            }
          }
        });
        }
      }else{
        console.log("multi ceneter")
      }
      $(document).on('change', '#school', function () {
        var id = $(this).val();

        $.ajax({
          method: 'POST',
          url: `/admin/lead/center`,
          data: {
            type: id
          },
          dataType: 'json',
          success: function (response) {

            $("#programcategory").empty();
            $("#programcategory").append(`<option value=''>Select programcategory</option>`);

            var len = response.data.length;
            for (var i = 0; i < len; i++) {
              var id = response.data[i]['_id'];
              var title = response.data[i]['title'];

              $("#programcategory").append(`<option value='${id}'>${title}</option>`);
            }
          }
        });
      });
    }
    })

    function openExistingLeadPopup () {
      $.fancybox.open(`
        <form method="POST" style="display: inline-block; width: 100%; max-width: 660px;" class="fancybox-content">
          <h2 class="mb-3">Attach a new sibling to existing lead</h2>
          <p style="display: none">
            <input type='hidden' name="employee_id" class="form-control"></input>
          </p>
          <input type='hidden' name="old_center_name" id="old_center_name" class="form-control" value=""></input>
          <p>
            <div class="col-md-12">
              <div class="form-group form-group-default">
                <label>Leads:</label>
                <select id="lead_id" class="form-control" name="lead_id" required>
                  <option value="">Select lead</option>
                </select>
              </div>
            </div>
          </p>
          <p class="mb-0">
            <button class="btn btn-primary btn-block" id="submit-btn" onclick="redirectToExistingleadForm();" type="button" disabled=true>Submit</button>
          </p>
        </form>
      `);
      $('#lead_id').select2({
        ajax: {
          url: "/admin/lead/get/leadsnumber/accordingtouser",
          dataType: 'json',
          delay: 250,
          data: function (params) {
            console.log(params);
            return {
              q: params.term, // search term
              page: params.page // page number
            };
          },
          processResults: function (data, params) {
            params.page = params.page || 1;
            return {
              results: data.items,
              pagination: {
                more: (params.page * 10) < data.total_count
              }
            };
          },
          cache: true
        },
        placeholder: 'Search for Leads',
        //- minimumInputLength: 1,
        templateResult: function (data) {
          if (data.loading) {
            return data.text;
          }

          var $result = $("<span></span>");

          $result.text(data.name);

          return $result;
        },
        templateSelection: function (data) {
          return data.name || data.text;
        }
      });
    }

    $(document).ready(function() {
      $(document).on('change', '#lead_id', function () {
        $('#submit-btn').prop('disabled', false);
      });
    })

    function chooseExistingLead () {
      //- alert('hey');
      openExistingLeadPopup();
      //- $.ajax({
      //-   method: 'GET',
      //-   url: `/admin/lead/get/leadsnumber/accordingtouser?page=1`,
      //-   dataType: 'json',
      //-   success: function (response) {
      //-     console.log(response,"---response");
      //-     swal.close();
      //-     //- centers = response.data;
      //-     //- openFancyBox(centers, center_name, center_id, lead_id);
      //-   }
      //- });
    }

    function redirectToExistingleadForm () {
     sall("Please wait...", 12000);
     console.log($('#lead_id').val());
     let leadId = $('#lead_id').val();
     if (leadId) {
      window.location.href = `/admin/lead/create/existing/${leadId}`;
     } else {
      swal.close();
      sall("Something went wrong.. Please try again later.", 2500);
     }
    }

    function sall (msg, time) {
      var SweetAlert2Demo = function () {
        //== Demos
        var initDemos = function () {
          swal(msg, {
            buttons: false,
            timer: time,
            backdrop:true,
            closeOnClickOutside: false,
            closeOnEsc: false
          })
        };

        return {
            //== Init
            init: function () {
              initDemos();
            },
          };
        }();
      jQuery(document).ready(function () {
        SweetAlert2Demo.init();
      });
    };
